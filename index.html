<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototype génération d'île</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="consignes">utilisez les touches z, q, s, d et les flèches pour vous déplacer</div>
    <script src="perlin.js"></script>
    <script type="module" src="island.js"></script>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three/build/three.module.js';
        import {generer_ile, dessiner_ile} from "./island.js";


        // On récupère la taille de la page
        const [w, h] = [window.innerWidth, window.innerHeight]

        // On récupère l'accès au canvas
        //let ctx = new_canvas_ctx(w, h)

        const resolution = 0.15
        const noise_scale = 0.0075
        const rayon_ile = 200
        const octaves = 1.2

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera( 75, w / h, 0.1, 1000 );

        const renderer = new THREE.WebGLRenderer();
        renderer.setSize( w, h );
        document.body.appendChild( renderer.domElement );
        const group = new THREE.Group()


        
        camera.position.z = 0;
        camera.position.y = 10;
        camera.position.x = 0
        camera.rotation.y = Math.PI

        // On génère la matrice de valeurs de l'île
        let island = generer_ile(resolution, noise_scale, w, h, rayon_ile)
    
        // On dessine sur le canvas l'île en fonction de la résolution
        dessiner_ile(group, island, octaves, resolution)
        scene.add(group)

	        function animate() {
				requestAnimationFrame( animate );

				//group.rotation.x += 1;
				//group.rotation.y += 0.1;

				renderer.render( scene, camera );
                renderer.setClearColor(0x77b5fe);
			}

		animate();
        
        //ajout de contrôles pour se déplacer sur l'île
        window.addEventListener("keydown", () => {

            switch (event.code) {
                case "ArrowDown":
                if (camera.position.y >=10) {
                camera.position.y -= 1}
                break;
                case "ArrowUp":
                if (camera.position.y <=50){
                camera.position.y += 1}
                break;
                case "ArrowLeft":
                camera.rotation.y += 0.1
                break;
                case "ArrowRight":
                camera.rotation.y -= 0.1
                break;
                case "KeyW":
                camera.position.z -= Math.cos(camera.rotation.y)
                camera.position.x -= Math.sin(camera.rotation.y)
                break;
                case "KeyA": 
                camera.position.z -= Math.cos(camera.rotation.y + Math.PI/2)
                camera.position.x -= Math.sin(camera.rotation.y + Math.PI/2)
                break;
                case "KeyD": 
                camera.position.z += Math.cos(camera.rotation.y + Math.PI/2)
                camera.position.x += Math.sin(camera.rotation.y + Math.PI/2)
                break;
                case "KeyS": 
                camera.position.z += Math.cos(camera.rotation.y)
                camera.position.x += Math.sin(camera.rotation.y)
                break;
            }
        })
    </script>
</body> 
</html>
