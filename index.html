<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototype génération d'île</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="./logo.png" type="image/png">
</head>
<body>
    <section>
        <div class="controls">
            <div id="regenerate">Regénérer</div>
            <div>
                <label for="seed">seed</label>
                <input type="number" id="seed" min="0" max="9999999">
            </div>
            <div>
                <label for="noise_scale">noise_scale</label>
                <input type="number" id="noise_scale" step="0.001" min="0.001">
            </div>
            <div>
                <label for="resolution">resolution</label>
                <input type="number" id="resolution" max="2" step="0.05" min="0.1">
            </div>
            <div>
                <label for="rayon_ile">rayon_ile</label>
                <input type="number" id="rayon_ile" step="10" min="0">
            </div>
            <div>
                <label for="octaves">octaves</label>
                <input type="number" id="octaves" step="0.1">
            </div>
            <div id="play">Jouer</div>
        </div>
    </section>
    <script src="perlin.js"></script>
    <script src="island.js"></script>
    <script>
        // On récupère la taille de la page
        let [w, h] = [window.innerWidth, window.innerHeight]

        // On récupère l'accès au canvas
        let canvas = () => document.getElementById("island")
        let ctx = new_canvas_ctx(w, h)

        const parametres = {
            seed: Math.floor(Math.random() * 9999999),
            resolution: 0.2,
            noise_scale: 0.0075,
            rayon_ile: 200,
            octaves: 1.5
        }

        const controls = {
            seed: document.getElementById("seed"),
            noise_scale: document.getElementById("noise_scale"),
            resolution: document.getElementById("resolution"),
            rayon_ile: document.getElementById("rayon_ile"),
            octaves: document.getElementById("octaves")
        }

        // On génère la matrice de valeurs de l'île
        noiseSeed(parametres.seed)
        let island = generer_ile(parametres.resolution, parametres.noise_scale, w, h, parametres.rayon_ile)
    
        // On dessine sur le canvas l'île en fonction de la résolution
        dessiner_ile(ctx, parametres.resolution, island, parametres.octaves)

        const regenerate = () => {
            island = generer_ile(parametres.resolution, parametres.noise_scale, w, h, parametres.rayon_ile)
            dessiner_ile(ctx, parametres.resolution, island, parametres.octaves)
        }
        
        document.getElementById("regenerate").addEventListener("click", () => {
            parametres.seed = Math.floor(Math.random() * 9999999)
            controls.seed.value = parametres.seed
            noiseSeed(parametres.seed)
            regenerate()
        })

        document.getElementById("play").addEventListener("click", () => {
            const cv = canvas()
            const intervalle = 5
            let [top, left] = [0, 0]
            cv.classList.add("playing")
            document.addEventListener("keypress", ev => {
                console.log(ev)
                if(ev.key == "s") {
                    top -= intervalle
                    cv.style.top = `${top}px`
                }
                if(ev.key == "z") {
                    top += intervalle
                    cv.style.top = `${top}px`
                }
                if(ev.key == "d") {
                    left -= intervalle
                    cv.style.left = `${left}px`
                }
                if(ev.key == "q") {
                    left += intervalle
                    cv.style.left = `${left}px`
                }
            })
        })

        for(let indice of Object.keys(controls)) {
            controls[indice].value = parametres[indice]
            controls[indice].addEventListener("input", event => {
                let value = parseFloat(controls[indice].value)
                parametres[indice] = value
                if(indice == "seed") noiseSeed(parametres.seed)
                regenerate()
            })
        }

        // Lorsque la fenêtre change de taille 
        window.addEventListener("resize", () => {
            [w, h] = [window.innerWidth, window.innerHeight]
            ctx = new_canvas_ctx(w, h)
            regenerate()
        })
    </script>
</body> 
</html>